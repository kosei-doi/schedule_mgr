<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スケジュール管理アプリ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Firebase SDK (v11) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
        import {
            getDatabase,
            ref,
            set,
            onValue,
            push,
            update,
            remove,
            get
        } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDCKnSSbdU-17Wzpjsi6gLPnXTCYZDbKPQ",
            authDomain: "schedule-mgr-b16fb.firebaseapp.com",
            databaseURL: "https://schedule-mgr-b16fb-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "schedule-mgr-b16fb",
            storageBucket: "schedule-mgr-b16fb.firebasestorage.app",
            messagingSenderId: "811941523003",
            appId: "1:811941523003:web:a25889182329fe03df761e",
            measurementId: "G-V1P050F1CJ"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);

        window.firebase = { app, analytics, db, ref, set, onValue, push, update, remove, get };
        console.log('Firebase v11 initialized successfully');
    </script>

    <div class="app">
        <!-- ヘッダー -->
        <header class="header">
            <h1 class="title">スケジュール管理</h1>
            <div class="header-controls">
                <div class="date-navigation">
                    <button id="prevDay" class="nav-btn" aria-label="前日/前週">←</button>
                    <span id="currentDate" class="current-date"></span>
                    <button id="nextDay" class="nav-btn" aria-label="翌日/翌週">→</button>
                    <button id="todayBtn" class="today-btn">今日</button>
                </div>
                <div class="view-toggle">
                    <button id="dayViewBtn" class="view-btn active">日次</button>
                    <button id="weekViewBtn" class="view-btn">週次</button>
                    <button id="monthViewBtn" class="view-btn">月次</button>
                </div>
                <div class="header-actions">
                    <button id="addEventBtn" class="add-btn">+ 予定追加</button>
                    <input id="importFile" type="file" accept=".json,.ics,text/calendar" style="display:none" />
                    <button id="importBtn" class="today-btn">インポート</button>
                    <button id="exportBtn" class="today-btn">エクスポート</button>
                </div>
            </div>
        </header>
        <div id="notificationArea" class="notification" role="status" aria-live="polite"></div>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- 日次ビュー -->
            <div id="dayView" class="view-container active">
                <div class="day-header">
                    <div class="time-column">時間</div>
                    <div class="events-column">予定</div>
                </div>
                <div class="day-all-day-row">
                    <div class="all-day-label" data-view="day">終日</div>
                    <div id="dayAllDayContainer" class="all-day-events">
                        <!-- 終日イベントがここに生成される -->
                    </div>
                </div>
                <div id="dayEvents" class="day-events">
                    <!-- 時間軸（0-23時） -->
                    <div class="time-slots">
                        <div class="time-slot" data-hour="4">04:00</div>
                        <div class="time-slot" data-hour="5">05:00</div>
                        <div class="time-slot" data-hour="6">06:00</div>
                        <div class="time-slot" data-hour="7">07:00</div>
                        <div class="time-slot" data-hour="8">08:00</div>
                        <div class="time-slot" data-hour="9">09:00</div>
                        <div class="time-slot" data-hour="10">10:00</div>
                        <div class="time-slot" data-hour="11">11:00</div>
                        <div class="time-slot" data-hour="12">12:00</div>
                        <div class="time-slot" data-hour="13">13:00</div>
                        <div class="time-slot" data-hour="14">14:00</div>
                        <div class="time-slot" data-hour="15">15:00</div>
                        <div class="time-slot" data-hour="16">16:00</div>
                        <div class="time-slot" data-hour="17">17:00</div>
                        <div class="time-slot" data-hour="18">18:00</div>
                        <div class="time-slot" data-hour="19">19:00</div>
                        <div class="time-slot" data-hour="20">20:00</div>
                        <div class="time-slot" data-hour="21">21:00</div>
                        <div class="time-slot" data-hour="22">22:00</div>
                        <div class="time-slot" data-hour="23">23:00</div>
                    </div>
                    <div id="dayEventContainer" class="event-container">
                        <!-- イベントがここに動的に追加される -->
                    </div>
                </div>
            </div>

            <!-- 週次ビュー -->
            <div id="weekView" class="view-container">
                <div class="week-header">
                    <div class="time-column">時間</div>
                    <div class="week-days">
                        <div class="day-header-cell" data-day="0">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="1">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="2">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="3">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="4">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="5">
                            <div class="day-date"></div>
                        </div>
                        <div class="day-header-cell" data-day="6">
                            <div class="day-date"></div>
                        </div>
                    </div>
                </div>
                <div class="week-all-day-row">
                    <div class="time-column" data-view="week">終日</div>
                    <div class="week-all-day-columns">
                        <div class="all-day-column" data-day="0"></div>
                        <div class="all-day-column" data-day="1"></div>
                        <div class="all-day-column" data-day="2"></div>
                        <div class="all-day-column" data-day="3"></div>
                        <div class="all-day-column" data-day="4"></div>
                        <div class="all-day-column" data-day="5"></div>
                        <div class="all-day-column" data-day="6"></div>
                    </div>
                </div>
                <div id="weekEvents" class="week-events">
                    <!-- 時間軸（0-23時） -->
                    <div class="time-slots">
                        <div class="time-slot" data-hour="4">04:00</div>
                        <div class="time-slot" data-hour="5">05:00</div>
                        <div class="time-slot" data-hour="6">06:00</div>
                        <div class="time-slot" data-hour="7">07:00</div>
                        <div class="time-slot" data-hour="8">08:00</div>
                        <div class="time-slot" data-hour="9">09:00</div>
                        <div class="time-slot" data-hour="10">10:00</div>
                        <div class="time-slot" data-hour="11">11:00</div>
                        <div class="time-slot" data-hour="12">12:00</div>
                        <div class="time-slot" data-hour="13">13:00</div>
                        <div class="time-slot" data-hour="14">14:00</div>
                        <div class="time-slot" data-hour="15">15:00</div>
                        <div class="time-slot" data-hour="16">16:00</div>
                        <div class="time-slot" data-hour="17">17:00</div>
                        <div class="time-slot" data-hour="18">18:00</div>
                        <div class="time-slot" data-hour="19">19:00</div>
                        <div class="time-slot" data-hour="20">20:00</div>
                        <div class="time-slot" data-hour="21">21:00</div>
                        <div class="time-slot" data-hour="22">22:00</div>
                        <div class="time-slot" data-hour="23">23:00</div>
                    </div>
                    <div class="week-event-container">
                        <div class="week-day" data-day="0">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="1">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="2">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="3">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="4">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="5">
                            <div class="day-events-container"></div>
                        </div>
                        <div class="week-day" data-day="6">
                            <div class="day-events-container"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 月次ビュー -->
            <div id="monthView" class="view-container">
                <div class="month-calendar">
                    <div class="month-weekdays">
                        <div class="weekday">日</div>
                        <div class="weekday">月</div>
                        <div class="weekday">火</div>
                        <div class="weekday">水</div>
                        <div class="weekday">木</div>
                        <div class="weekday">金</div>
                        <div class="weekday">土</div>
                    </div>
                    <div id="monthGrid" class="month-grid">
                        <!-- 月次カレンダーの日付がここに動的に生成される -->
                    </div>
                </div>
            </div>
        </main>

        <!-- イベント追加/編集フォーム（モーダル） -->
        <div id="eventModal" class="modal" role="dialog" aria-hidden="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">予定を追加</h2>
                    <button id="closeModal" class="close-btn" aria-label="閉じる">&times;</button>
                </div>
                <form id="eventForm" class="event-form">
                    <div class="form-section main-section">
                        <div class="form-group">
                            <label for="eventTitle">タイトル *</label>
                            <input type="text" id="eventTitle" name="title" required maxlength="100" aria-required="true">
                        </div>
                        <div class="form-row compact-row">
                            <div class="form-group compact">
                                <label for="eventStartTime">開始 *</label>
                                <input type="datetime-local" id="eventStartTime" name="startTime" required aria-required="true">
                            </div>
                            <div class="form-group compact">
                                <label for="eventEndTime">終了 *</label>
                                <input type="datetime-local" id="eventEndTime" name="endTime" required aria-required="true">
                            </div>
                        </div>
                        <div class="form-row all-day-date-row hidden" id="allDayDateRow">
                            <div class="form-group compact">
                                <label for="eventAllDayStart">開始日 *</label>
                                <input type="date" id="eventAllDayStart" name="allDayStart">
                            </div>
                            <div class="form-group compact">
                                <label for="eventAllDayEnd">終了日 *</label>
                                <input type="date" id="eventAllDayEnd" name="allDayEnd">
                            </div>
                        </div>
                        <div class="form-group compact">
                            <label for="eventDescription">説明</label>
                            <textarea id="eventDescription" name="description" rows="1" maxlength="500" placeholder="オプション"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section options-section">
                        <div class="form-group checkbox-group compact">
                            <label class="checkbox-label">
                                <input type="checkbox" id="eventAllDay" name="allDay">
                                終日イベント
                            </label>
                        </div>
                        <div class="form-group compact">
                            <label for="eventColor">色</label>
                            <div class="color-picker" role="radiogroup" aria-label="イベントの色を選択">
                                <input type="radio" id="color-blue" name="color" value="#3b82f6" checked>
                                <label for="color-blue" class="color-option" style="background-color: #3b82f6;" aria-label="青"></label>
                                <input type="radio" id="color-green" name="color" value="#10b981">
                                <label for="color-green" class="color-option" style="background-color: #10b981;" aria-label="緑"></label>
                                <input type="radio" id="color-yellow" name="color" value="#f59e0b">
                                <label for="color-yellow" class="color-option" style="background-color: #f59e0b;" aria-label="黄"></label>
                                <input type="radio" id="color-red" name="color" value="#ef4444">
                                <label for="color-red" class="color-option" style="background-color: #ef4444;" aria-label="赤"></label>
                                <input type="radio" id="color-purple" name="color" value="#8b5cf6">
                                <label for="color-purple" class="color-option" style="background-color: #8b5cf6;" aria-label="紫"></label>
                                <input type="radio" id="color-pink" name="color" value="#ec4899">
                                <label for="color-pink" class="color-option" style="background-color: #ec4899;" aria-label="ピンク"></label>
                            </div>
                        </div>
                        <div class="form-row compact-row">
                            <div class="form-group compact">
                                <label for="eventReminder">通知</label>
                                <select id="eventReminder" name="reminderMinutes">
                                    <option value="">なし</option>
                                    <option value="0">開始時</option>
                                    <option value="5">5分前</option>
                                    <option value="10">10分前</option>
                                    <option value="30">30分前</option>
                                    <option value="60">60分前</option>
                                </select>
                            </div>
                            <div class="form-group compact">
                                <label for="eventRecurrence">繰り返し</label>
                                <select id="eventRecurrence" name="recurrence">
                                    <option value="none">なし</option>
                                    <option value="daily">毎日</option>
                                    <option value="weekly">毎週</option>
                                    <option value="monthly">毎月</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group compact hidden" id="recurrenceEndGroup">
                            <label for="eventRecurrenceEnd">繰り返し終了日</label>
                            <input type="date" id="eventRecurrenceEnd" name="recurrenceEnd">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="cancelBtn" class="btn btn-secondary">キャンセル</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                        <button type="button" id="deleteBtn" class="btn btn-danger" style="display: none;">削除</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 確認モーダル -->
        <div id="confirmModal" class="modal" role="dialog" aria-hidden="true">
            <div class="modal-content confirm-modal-content">
                <div class="modal-header">
                    <h2 id="confirmTitle">確認</h2>
                </div>
                <div class="confirm-body">
                    <p id="confirmMessage"></p>
                </div>
                <div class="form-actions">
                    <button type="button" id="confirmCancelBtn" class="btn btn-secondary">キャンセル</button>
                    <button type="button" id="confirmOkBtn" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>

        <!-- ローディングオーバーレイ -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <p class="loading-text">処理中...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

